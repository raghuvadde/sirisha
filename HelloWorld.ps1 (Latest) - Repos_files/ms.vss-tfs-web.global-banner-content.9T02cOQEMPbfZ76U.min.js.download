"use strict";define("TFS/GlobalBanner",["require","exports","VSS/Platform/Context","VSS/Platform/Fetch","react","VSS/Platform/Layout","VSS/Platform/Components/Format","OfficeFabric/Icon"],function(n,t,i,r,u,f,e,o){var h,s,c;(function(n){h=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});t[n].Dismiss="Dismiss";t[n].LearnMore="Learn more"})("Resources"),function(n){var f;s=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});t[n].GlobalMessageChangedEvent="MESSAGE_CHANGED";var u="globalMessageData",e="GlobalMessage/Dismissed/",o=function(i){function f(){var n=i!==null&&i.apply(this,arguments)||this;return n.handleEndRequest=function(t){var i,r;if(t.response&&t.response.headers&&(i=t.response.headers.get("X-VSS-GlobalMessage"),i))try{r=JSON.parse(i);n.setGlobalMessageBanner(r,!1,!0)}catch(u){console.warn("Failed to deserialize X-VSS-GlobalMessage header: "+u)}},n.handleLegacyGlobalMessage=function(t){n.setGlobalMessageBanner(t.detail,!1,!0)},n}return __extends(f,i),f.prototype._serviceStart=function(n){i.prototype._serviceStart.call(this,n);var f=this.pageContext.getService("IVssContributionService"),t=f.getSharedData(u);this.currentMessageBanners=t&&t.banners&&t.banners.length>0?t.banners:[];r.requestListeners.subscribe(this.handleEndRequest,"afterRequest");document.body.addEventListener("legacyGlobalMessage",this.handleLegacyGlobalMessage)},f.prototype._serviceEnd=function(){r.requestListeners.unsubscribe(this.handleEndRequest,"afterRequest");document.body.removeEventListener("legacyGlobalMessage",this.handleLegacyGlobalMessage)},f.prototype.getGlobalMessageBanner=function(){return this.currentMessageBanners[0]},f.prototype.setGlobalMessageBanner=function(i,r,u){if(u){var f=this.currentMessageBanners[0];if(f&&(f.level||0)>=(i.level||0))return}r&&this.currentMessageBanners.shift();this.currentMessageBanners.unshift(i);this._notify(i,t[n].GlobalMessageChangedEvent)},f.prototype.getGlobalMessageActions=function(){var t=this.pageContext.getService("IVssContributionService"),n=t.getSharedData(u);return n&&n.actions?n.actions:undefined},f.prototype.closeGlobalMessage=function(){var i=this.getGlobalMessageBanner(),r,u;i&&i.settingId&&(r={},r[e+i.settingId]=!0,u=this.pageContext.getRestClient("ISettingsRestClient"),u.setEntries(r,"me"));this.currentMessageBanners.shift();this._notify(this.currentMessageBanners[0],t[n].GlobalMessageChangedEvent)},f}(i.VssObservableService);i.Services.add("IGlobalMessagesService",{serviceFactory:o});f=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.setGlobalMessageBanner=function(n){var t=this.pageContext.getService("IGlobalMessagesService");t.setGlobalMessageBanner(n)},t}(i.VssService);i.Services.add("ms.vss-tfs-web.tfs-global-messages-service",{serviceFactory:f,options:1})}("GlobalMessagesService"),function(n){var i,r;c=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});i=function(n){function t(t,i){var r=n.call(this,t,i)||this,u;return r.onFpsCompleted=function(){r.globalMessagesService.unsubscribe(r.onMessageBannerChanged,s.GlobalMessageChangedEvent);r.globalMessagesService=r.context.pageContext.getService("IGlobalMessagesService");r.globalMessagesService.subscribe(r.onMessageBannerChanged,s.GlobalMessageChangedEvent);var n=r.globalMessagesService.getGlobalMessageBanner();r.setState({messageBanner:n})},r.onMessageBannerClose=function(){r.globalMessagesService.closeGlobalMessage()},r.onMessageBannerChanged=function(n){r.setState({messageBanner:n})},r.layoutManager=r.context.pageContext.getService("IVssLayoutManager"),r.globalMessagesService=i.pageContext.getService("IGlobalMessagesService"),r.globalMessagesService.subscribe(r.onMessageBannerChanged,s.GlobalMessageChangedEvent),u=r.globalMessagesService.getGlobalMessageBanner(),r.state={messageBanner:u},r}return __extends(t,n),t.prototype.render=function(){var s=this,n=this.state.messageBanner;if(!n)return null;var r=n.level,i="info-message",t="Info";return r===3?(i="success-message",t="Completed"):r===2?(i="error-message",t="Error"):r===1&&(i="warning-message",t="Warning"),n.customIcon&&(t=n.customIcon),u.createElement("div",{className:"global-message-banner flex flex-grow fontSizeM "+i},u.createElement(o.Icon,{iconName:t,className:"level-icon"}),n.message||n.messageFormat&&n.messageLinks?n.messageFormat&&n.messageLinks?u.createElement(e.FormatComponent,{className:"message",format:n.messageFormat},n.messageLinks.map(function(n,t){return u.createElement("a",{href:n.href,target:"_blank",rel:"noopener noreferrer",key:t},n.name)})):u.createElement("div",{className:"message"},n.message):null,n._links&&n._links.learn?u.createElement("a",{className:"learn-link",href:n._links.learn.href},h.LearnMore):null,n.componentType?u.createElement(f.WrappedComponent,__assign({wrappedType:n.componentType,dependencies:n.contentDependencies},Object.assign({onDismiss:this.onMessageBannerClose},n.contentProperties))):null,n.dismissable!==!1?u.createElement(o.Icon,{iconName:"Cancel",className:"dismiss",tabIndex:0,role:"button","aria-label":h.Dismiss,onClick:this.onMessageBannerClose,onKeyDown:function(n){(n.keyCode===13||n.keyCode===32)&&s.onMessageBannerClose()}}):null)},t.prototype.componentDidMount=function(){n.prototype.componentDidMount.call(this);this.addEventListener(document.body,"fpsCompleted",this.onFpsCompleted)},t.prototype.componentWillUnmount=function(){this.globalMessagesService.unsubscribe(this.onMessageBannerChanged,s.GlobalMessageChangedEvent);n.prototype.componentWillUnmount.call(this)},t.componentType="globalBanner",t}(f.VssComponent);f.VssComponent.register(i.componentType,i);r=function(n){function t(t,i){var r=n.call(this,t,i)||this,s,h,e,o,c;if(r.globalMessagesService=i.pageContext.getService("IGlobalMessagesService"),r.layoutManager=i.pageContext.getService("IVssLayoutManager"),r.actions=r.globalMessagesService.getGlobalMessageActions(),r.actions&&r.actions.length)for(s=function(n){h.layoutManager.renderCallout(function(t){return u.createElement(f.WrappedComponent,__assign({wrappedType:n.componentType,dependencies:n.contentDependencies},Object.assign({onClose:t},n.contentProperties)))})},h=this,e=0,o=r.actions;e<o.length;e++)c=o[e],s(c);return r}return __extends(t,n),t.prototype.render=function(){return null},t.componentType="globalActions",t}(f.VssComponent);f.VssComponent.register(r.componentType,r)}("ComponentsGlobalMessageBanner")},["Resources","GlobalMessagesService","Components/GlobalMessageBanner"]);document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-tfs-web.global-banner-content"}}));