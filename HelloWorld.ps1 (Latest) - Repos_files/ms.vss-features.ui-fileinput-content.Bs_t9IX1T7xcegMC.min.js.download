"use strict";define("VSSUI",["require","exports","react","OfficeFabric/Utilities"],function(n,t,i,r){var u,f,e,o;(function(n){var i,r;u=t[n]={};Object.defineProperty(t,"__esModule",{value:!0}),function(n){n[n.Unknown=0]="Unknown";n[n.Binary=1]="Binary";n[n.ASCII=2]="ASCII";n[n.UTF8=3]="UTF8";n[n.UTF32_BE=4]="UTF32_BE";n[n.UTF32_LE=5]="UTF32_LE";n[n.UTF16_BE=6]="UTF16_BE";n[n.UTF16_LE=7]="UTF16_LE"}(i=t[n].FileEncoding||(t[n].FileEncoding={})),function(n){n[n.Base64EncodedText=0]="Base64EncodedText";n[n.RawText=1]="RawText";n[n.RawFile=2]="RawFile"}(r=t[n].FileInputContentType||(t[n].FileInputContentType={}))})("ComponentsFileInputFileInputProps"),function(n){function o(n){var u,t,f,r,e,i;if(typeof atob=="undefined")return 0;for(u=window.atob(n),t=[],r=0;r<4;r++)t.push(u.charCodeAt(r));if(t[0]===254&&t[1]===255)return 6;if(t[0]===255&&t[1]===254)return t[2]===0&&t[3]===0?5:7;if(t[0]===239&&t[1]===187&&t[2]===191)return 3;if(t[0]===0&&t[1]===0&&t[2]===254&&t[3]===255)return 4;for(f=!0,r=0,e=u.length;r<e;r++){if(i=u.charCodeAt(r),(i<=31||i==127)&&i!=9&&i!=12&&i!=13&&i!=10&&i!=26)return 1;i>127&&(f=!1)}return f?2:3}var u,e;f=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});u=function(n){function u(){var i=n!==null&&n.apply(this,arguments)||this;return i._files=[],i._clear=function(){i._files.forEach(function(n){n.fileReader.readyState!==FileReader.DONE&&n.fileReader.abort()});i._files=[];i.setState({files:i._files,errorMessage:""});i._triggerUpdateEvent()},i._remove=function(n){i._files=i._files.filter(function(t){return t!==n});i.setState({files:i._files});i._triggerUpdateEvent()},i._addFiles=function(n){var c,l,s,h,o,a,v,y,f,u,e;if(i.props.allowedFileExtensions&&i.props.allowedFileExtensions.length>0)for(u=0;u<n.length;u++){for(c=n[u].name.split(".").pop(),l=!1,s=0;s<i.props.allowedFileExtensions.length;s++)if(c.toLocaleLowerCase()===i.props.allowedFileExtensions[s].toLocaleLowerCase()){l=!0;break}if(!l){f=r.format(t.VSSResourcesVSSUI.FileInputErrorNotAllowedExtensionType,c,i.props.allowedFileExtensions.join());i.setState({errorMessage:f});return}}for(h={},u=0,e=i._files.length;u<e;u++)h[i.props.fileNamesCaseSensitive?i._files[u].result.name:i._files[u].result.name.toLowerCase()]=1;for(o=i._getTotalFilesSize(),u=0,e=n.length;u<e;u++){if(i.props.maximumSingleFileSize&&n[u].size>i.props.maximumSingleFileSize){f=i._getLimitErrorMessage(r.format(t.VSSResourcesVSSUI.FileInputErrorMaxFileSize,n[u].name,i._getFriendlySizeString(n[u].size),i._getFriendlySizeString(i.props.maximumSingleFileSize)),{fileSize:n[u].size});i.setState({errorMessage:f});return}if(o+=n[u].size,a=i.props.fileNamesCaseSensitive?n[u].name:n[u].name.toLowerCase(),h[a]){f=r.format(t.VSSResourcesVSSUI.FileInputErrorDuplicateFileName,n[u].name);i.setState({errorMessage:f});return}h[a]=1}if(i.props.maximumTotalFileSize&&o>i.props.maximumTotalFileSize){f=i._getLimitErrorMessage(r.format(t.VSSResourcesVSSUI.FileInputErrorTotalFileSize,i._getFriendlySizeString(o),i._getFriendlySizeString(i.props.maximumTotalFileSize)),{totalSize:o});i.setState({errorMessage:f});return}if(v=i._files.length+n.length,i.props.maximumNumberOfFiles&&v>i.props.maximumNumberOfFiles){y=i.props.maximumNumberOfFiles===1?t.VSSResourcesVSSUI.FileInputErrorSingleFileOnly:r.format(t.VSSResourcesVSSUI.FileInputErrorMaxNumFiles,i.props.maximumNumberOfFiles);f=i._getLimitErrorMessage(y,{fileCount:v});i.setState({errorMessage:f});return}for(u=0,e=n.length;u<e;u++)i._addFile(n[u])},i}return __extends(u,n),u.prototype.render=function(){var n=this.props.maximumNumberOfFiles||0,r=this._files,h=this.state&&this.state.errorMessage?this.state.errorMessage:"",c=!n||r.length<n,u=null,f,o,s;return this.props.allowedFileExtensions&&(f=this.props.allowedFileExtensions.map(function(n){return n[0]!=="."?"."+n:n}),u=f.join()),o=n===1?t.VSSResourcesVSSUI.FileInputDragDropSingleFileLabel:t.VSSResourcesVSSUI.FileInputDragDropLabel,s=n!==1,i.createElement(e,{dragDropLabel:o,multiple:s,canAddMoreFiles:c,accept:u,files:r,errorMessage:h,addFiles:this._addFiles,remove:this._remove,clear:this._clear})},u.prototype._addFile=function(n){var u=this,i={name:n.name,size:n.size,type:n.type,lastModifiedDate:n.lastModifiedDate,statusText:t.VSSResourcesVSSUI.Loading,isError:!1},f=new FileReader,h={result:i,fileReader:f},e,s;this._files.push(h);e=function(){u.setState({files:u._files,errorMessage:u.state&&u.state.errorMessage?u.state.errorMessage:""});u._triggerUpdateEvent()};s=function(){i.statusText=u._getFriendlySizeString(n.size);e()};f.onload=function(){if(i.encoding=0,u.props.resultContentType===1)i.content=f.result||"";else{var n=f.result;n&&n.indexOf(",")>-1?(i.content=n.substr(n.indexOf(",")+1),i.content.substr(0,2)==="//"&&i.content.length%4==2&&(i.content=i.content.substr(2))):i.content="";u.props.detectEncoding&&(i.encoding=o(i.content))}s()};f.onerror=function(){var n=r.format(t.VSSResourcesVSSUI.FileInputReadErrorFormat,i.name,f.error.message);i.statusText=t.VSSResourcesVSSUI.FileInputErrorLabel;i.isError=!0;e()};f.onloadend=function(){e()};this.props.resultContentType===1?f.readAsText(n):this.props.resultContentType===2?(i.encoding=0,i.file=n,s(),e()):f.readAsDataURL(n)},u.prototype._triggerUpdateEvent=function(){this.props.updateHandler&&this.props.updateHandler({loading:this._files.some(function(n){return n.fileReader.readyState!==FileReader.DONE}),files:this._files})},u.prototype._getTotalFilesSize=function(){for(var t=0,i=this._files,n=0,r=i.length;n<r;n++)t+=i[n].result.size;return t},u.prototype._getLimitErrorMessage=function(n,t){var i=n;return this.props.limitMessageFormatter&&(i=this.props.limitMessageFormatter(n,t)),i},u.prototype._getFriendlySizeString=function(n,i){i===void 0&&(i=1);var u=Math.pow(10,i);return n<1024?r.format(t.VSSResourcesVSSUI.FileSizeBytesFormat,n):n<1048576?r.format(t.VSSResourcesVSSUI.FileSizeKBFormat,Math.round(n/1024*10)/10):r.format(t.VSSResourcesVSSUI.FileSizeMBFormat,Math.round(n/1048576*10)/10)},u}(r.BaseComponent);t[n].FileInput=u;e=function(n){function u(){var t=n!==null&&n.apply(this,arguments)||this;return t._onClearClick=function(){t.props.clear&&t.props.clear()},t._onRemoveClick=function(n){t.props.remove&&t.props.remove(n)},t._onRemoveKeyDown=function(n,i){(n.key==="Enter"||n.key===" "||n.key==="Spacebar")&&t.props.remove&&t.props.remove(i)},t._onBrowseContainerClick=function(){t._fileInput&&t._fileInput.click()},t._onBrowseContainerKeyPress=function(n){t._fileInput&&(n.which===13||n.which===32)&&t._fileInput.click()},t._resolveFileInput=function(n){t._fileInput=n},t._resolveRemoveLink=function(n){t._removeLink||(t._removeLink=n)},t._onDragEnter=function(n){t._setDropEffect(n);n.preventDefault();t.setState({isDragging:!0})},t._onDragLeave=function(n){n.preventDefault();t.setState({isDragging:!1})},t._onDragOver=function(n){t._setDropEffect(n);n.preventDefault();t.setState({isDragging:!0})},t._onDrop=function(n){t._setDropEffect(n);n.preventDefault();t.setState({isDragging:!1});var i=n.dataTransfer.files;i&&i.length>0&&t.props.addFiles&&t.props.addFiles(i)},t._onFileInputChange=function(n){t._removeLink=undefined;n.currentTarget.files&&n.currentTarget.files.length&&(t.props.addFiles&&t.props.addFiles(n.currentTarget.files),n.currentTarget.value="")},t}return __extends(u,n),u.prototype.render=function(){var n=this,u=r.css("vss-FileInput-filesDropTarget",this.state.isDragging?this.props.dragOverCssClass||"vss-FileInput-dragOver":"");return i.createElement("div",{className:"vss-FileInput"},this.props.canAddMoreFiles&&i.createElement("div",{className:u,onDragOver:this._onDragOver,onDragLeave:this._onDragLeave,onDragEnter:this._onDragEnter,onDrop:this._onDrop},i.createElement("div",{className:"vss-FileInput-dragDropTable",role:"presentation"},i.createElement("div",{className:"vss-FileInput-dragDropLabel"},i.createElement("span",null,this.props.dragDropLabel)),i.createElement("div",{className:"vss-FileInput-browseButton"},i.createElement("button",{className:"vss-FileInput-browseContainer",onKeyPress:this._onBrowseContainerKeyPress,onClick:this._onBrowseContainerClick},t.VSSResourcesVSSUI.FileInputBrowseButtonLabel),i.createElement("input",{type:"file",ref:this._resolveFileInput,onChange:this._onFileInputChange,accept:this.props.accept,multiple:this.props.multiple,style:{display:"none"}})))),this.props.files.length>1&&i.createElement("div",{className:"vss-FileInput-overallStatusContainer"},i.createElement("span",{className:"vss-FileInput-overallStatusActions"},i.createElement("a",{onClick:this._onClearClick},t.VSSResourcesVSSUI.FileInputRemoveAll))),i.createElement("div",{className:"vss-FileInput-errorContainer"},this.props.errorMessage),this.props.files.length>0&&i.createElement("ul",{className:"vss-FileInput-fileList",style:{display:"block"}},this.props.files.map(function(r){return i.createElement("li",{key:r.result.name},i.createElement("div",{className:"vss-FileInput-headerContainer"},i.createElement("span",{className:"vss-FileInput-fileName"},r.result.name)),i.createElement("div",{className:"vss-FileInput-detailsContainer"},i.createElement("span",{className:"vss-FileInput-status"},r.result.statusText),i.createElement("span",{className:"vss-FileInput-links"},i.createElement("a",{tabIndex:0,ref:n._resolveRemoveLink,onKeyDown:function(t){return n._onRemoveKeyDown(t,r)},onClick:function(){return n._onRemoveClick(r)},role:"button"},t.VSSResourcesVSSUI.FileInputRemoveFile))))})))},u.prototype.componentWillMount=function(){this.setState({isDragging:!1})},u.prototype.componentDidUpdate=function(){this._removeLink&&this._removeLink.focus()},u.prototype._setDropEffect=function(n){try{n.dataTransfer.dropEffect="copy"}catch(t){}},u}(r.BaseComponent)}("ComponentsFileInputFileInput"),function(n){function i(i){for(var r in i)t[n].hasOwnProperty(r)||(t[n][r]=i[r])}e=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});i(f);i(u)}("ComponentsFileInputindex"),function(n){function i(i){for(var r in i)t[n].hasOwnProperty(r)||(t[n][r]=i[r])}o=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});i(e)}("FileInput")},["Components/FileInput/FileInput.Props","Components/FileInput/FileInput","Components/FileInput/index","FileInput"]);document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-features.ui-fileinput-content"}}));