"use strict";define("VSS/Legacy",["require","exports","react","VSS/Platform/Context","VSS/Platform/Layout"],function(n,t,i,r,u){var f;(function(n){function a(n){return s?s.getService(n):undefined}var h;f=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});var o="ms.vss-web.legacy-platform-data-provider",c=[o,"ms.vss-web.legacy-vss-ui-content"],e=window,s,l=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype._serviceStart=function(t){n.prototype._serviceStart.call(this,t);var r=this.pageContext.getService("IVssContributionService"),i=r.getData(o);i&&i.preloadContent&&this._ensureLegacyContentLoaded(function(){})},t.prototype.loadModules=function(n,t){var i=this;return new Promise(function(r){var u=function(){n&&n.length?e.requirejs("VSS/VSS").requireModules(n).then(function(){r()}):r()};i._ensureLegacyContentLoaded(function(){t&&t.length?e.requirejs(["VSS/Service","VSS/Contributions/Services"],function(n,i){n.getService(i.ExtensionService).getContributions(t,!0,!0,!0).then(function(){u()})}):u()})})},t.prototype.getLegacyPageContext=function(n){var t=this;return this.loadModules().then(function(){var i=e.__vssPageContext,r;return n&&!i.webContext.team?(r=t.pageContext.getService("IVssContributionService"),r.getDataAsync("ms.vss-tfs-web.team-context-data-provider").then(function(n){return n&&(i=__assign({},i,{webContext:__assign({},i.webContext,{team:__assign({},n)})})),i})):e.__vssPageContext})},t.prototype.requireModules=function(n){return this.loadModules(n).then(function(){return n.map(function(n){return e.requirejs(n)})})},t.prototype._ensureLegacyContentLoaded=function(n){var u=this,r,t,i;this._legacyContentLoaded||e.__legacyContentLoaded?n():this._legacyContentLoadedCallbacks?this._legacyContentLoadedCallbacks.push(n):(this._legacyContentLoadedCallbacks=[n],r=this.pageContext.getService("IVssPerformanceService"),r.addSplitTiming("LegacyPlatformService.LoadStarted"),t=this.pageContext.getService("IVssContributionService"),i=t.getData(o),i?this._processLegacyData(i):t.getContributionsAsync(c).then(function(){var i=t.getData(o),n;i&&(n=t.getData("ms.vss-tfs-web.page-data"),n&&(n.project&&(i.pageContext.webContext.project={id:n.project.id,name:n.project.name}),n.team&&(i.pageContext.webContext.team={id:n.team.id,name:n.team.name})),u._processLegacyData(i))}))},t.prototype._processLegacyData=function(n){var t=this,i=this.pageContext.getService("IVssContentService");i.loadScripts(n.content).then(function(){var i=t.pageContext.getService("IVssPerformanceService");i.addSplitTiming("LegacyPlatformService.ContentLoaded");t._processLegacyDataWithDOM(n)})},t.prototype._processLegacyDataWithDOM=function(n){var t=this,i=document.createElement("div"),u,r;i.classList.add("legacy-data");i.style.display="none";document.body.appendChild(i);this._createLegacyJsonIsland(i,"feature-licenses",n.featureLicenseInfo);this._createLegacyJsonIsland(i,"vss-contribution-data",n.contributionsPageData);this._createLegacyJsonIsland(i,"vss-bundle-data",n.content.filter(function(n){return!!n.bundle}));e._builtinPlugins=n.builtInPlugins;e._builtInBases=n.builtInPluginBases;e.__vssPageContext=n.pageContext;e.__cultureInfo=e.__vssPageContext.microsoftAjaxConfig.cultureInfo;e.requirejs.config(e.__vssPageContext.moduleLoaderConfig);e.requirejs.config({map:{"*":{React:"react"}}});u=this.pageContext.getService("IVssNavigationService");r=u.getCurrentRoute();e.__vssPageContext.navigation.routeId=r.routeId;e.__vssPageContext.navigation.routeTemplates=r.routeTemplates;s=this.pageContext;document.body.addEventListener("fpsLoading",function(){e.__legacyFpsLoading=!0});document.body.addEventListener("fpsCompleted",function(n){if(n.detail.success){var r=t.pageContext.getService("IVssContributionService"),i=r.getData(o);e.__legacyFpsLoading=!1;e.__updatedLegacyData=i;s=t.pageContext;i&&document.body.dispatchEvent(new CustomEvent("legacyFpsComplete",{detail:i}))}});window.performance&&window.performance.mark&&window.performance.mark("requireStart");e.requirejs(n.scriptsToRequire,function(){var n,i,r;if(window.performance&&window.performance.mark&&window.performance.mark("requireEnd"),e.requiredModulesLoaded=!0,e.requirejs(["VSS/Events/Page"],function(n){n.getService().fire(n.CommonPageEvents.InitialScriptsLoaded)}),t._legacyContentLoaded=!0,t._legacyContentLoadedCallbacks){for(n=0,i=t._legacyContentLoadedCallbacks;n<i.length;n++)r=i[n],r();delete t._legacyContentLoadedCallbacks}})},t.prototype._createLegacyJsonIsland=function(n,t,i){var r=document.createElement("script");r.type="application/json";r.classList.add(t);r.innerText=JSON.stringify(i);n.appendChild(r)},t}(r.VssService);r.Services.add("ILegacyPlatformService",{serviceFactory:l,options:6});h=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.onDependenciesResolved=function(){var n=t.context.pageContext.getService("ILegacyPlatformService");return n.loadModules(t.props.modules,t.props.dependentContributionIds)},t}return __extends(t,n),t.prototype.render=function(){var n=__assign({},this.props,{modules:undefined,dependentContributionIds:undefined,onDependenciesResolved:this.onDependenciesResolved});return this.props.componentType&&(n.wrappedType=this.props.componentType),i.createElement(u.WrappedComponent,n,this.props.children)},t}(u.VssComponent);t[n].LegacyComponent=h;t[n].getLWPService=a;u.Components.add("legacy",h)})("Legacy")},["Legacy"]);document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-web.legacy-content"}}));