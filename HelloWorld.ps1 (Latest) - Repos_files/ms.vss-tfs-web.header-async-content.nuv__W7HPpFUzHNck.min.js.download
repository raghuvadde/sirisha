"use strict";define("Tfs/Header/Components",["require","exports","react","VSS/Features/Frame/ContributedBreadcrumbItemProvider","VSS/Platform/Layout","VSSUI/VssBreadcrumb","OfficeFabric/Utilities","OfficeFabric/Icon","VSSUI/Tooltip","VSSUI/Layer","OfficeFabric/Spinner","VSS/Platform/Context","VSS/Platform/FPS","VSS/Core/Util/String"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){var y,w,p,b,k,d,g,nt,tt,it;(function(n){y=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});t[n].Browse="Browse...";t[n].BrowseHome="{0} Home";t[n].KeyboardShortcuts="Keyboard shortcuts";t[n].NewTeam="New team";t[n].Projects="Projects";t[n].ProjectTitle="Project '{0}'";t[n].SelectProject="Select a project";t[n].TeamTitle="Team '{0}' in Project '{1}'";t[n].Loading="Loading...";t[n].MoreApplications="More";t[n].Marketplace="Marketplace";t[n].AppSwitcherHomeLink="Home";t[n].Pin="Pin item";t[n].Unpin="Unpin item"})("Resources"),function(n){w=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});var o=300,s="200px",h=12,e=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r._ttiMarked=!1,r.onSearchExpanded=function(){r.setState({isVisible:!1})},r.onSearchCollapsed=function(){r.setState({isVisible:!0})},r.onFpsLoaded=function(){r._ttiMarked=!1;r.setState({breadcrumbProviders:r.getBreadcrumbItemProviders()})},r.onItemsLoaded=function(){if(!r._ttiMarked){var n=r.context.pageContext.getService("IVssPerformanceService");n.endScenario("tfs","WebPlatform.Frame",!1);r._ttiMarked=!0}},r.state={isVisible:!0,breadcrumbProviders:r.getBreadcrumbItemProviders()},r}return __extends(t,n),t.prototype.componentDidMount=function(){this.addEventListener(window,"searchExpanded",this.onSearchExpanded);this.addEventListener(window,"searchCollapsed",this.onSearchCollapsed);this.addEventListener(document.body,"fpsLoaded",this.onFpsLoaded)},t.prototype.render=function(){if(!this.state.isVisible)return null;var n=this.context.pageContext.getService("IVssNavigationService");return i.createElement(f.VssBreadcrumb,{key:"header-breadcrumb-"+n.getDisplayedNavigation(),className:"header-breadcrumb",dividerType:1,presentationStyles:7,pickListWidth:o,providers:this.state.breadcrumbProviders,maxItemWidth:s,maxDisplayedItems:h,onItemsLoaded:this.onItemsLoaded})},t.prototype.getBreadcrumbItemProviders=function(){return[new r.ContributedBreadcrumbItemProvider(this.context.pageContext,"ms.vss-tfs-web.vertical-header-breadcrumb")]},t.componentType="headerBreadcrumb",t}(u.VssComponent);u.VssComponent.register(e.componentType,e)}("ComponentsHeaderBreadcrumbHeaderBreadcrumb"),function(n){p=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});var r=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.pinFocused=!1,t._onMenuKeyDown=function(n){if(!n.defaultPrevented)switch(n.keyCode){case 39:document.activeElement!==t.pinElement&&(t.pinElement&&t.pinElement.focus(),n.preventDefault(),n.stopPropagation())}},t._onPinKeyDown=function(n){if(!n.defaultPrevented)switch(n.keyCode){case 13:case 32:t.props.item.invalidateItem&&t.props.item.invalidateItem();t._togglePinState();n.preventDefault();n.stopPropagation();break;case 37:t.menuElement&&t.menuElement.focus();n.preventDefault();n.stopPropagation()}},t._onPinClick=function(n){n.stopPropagation();n.preventDefault();t._togglePinState()},t}return __extends(t,n),t.prototype.render=function(){var t=this,n=this.props.item,r=n.iconProps?n.iconProps:{iconName:n.icon},u=y.Pin,f,h="Pin";return n.pinningOptions&&n.pinningOptions.isPinned&&(u=y.Unpin,f="unpin",h="Unpin"),i.createElement("div",{className:"pinned-menu-item",id:this.props.item.key},i.createElement("a",__assign({},e.getNativeProps(this.props.item,e.anchorProperties),{ref:function(n){t.menuElement=n},href:this.props.item.href,className:e.css("ms-ContextualMenu-link",(this.props.item.isDisabled||this.props.item.disabled)&&"is-disabled"),role:"menuitem",style:this.props.item.style,"data-is-focusable":!0,onKeyDown:this._onMenuKeyDown}),i.createElement("div",{className:"ms-ContextualMenu-linkContent"},n.menuHasIcons||n.icon&&n.color?i.createElement(o.Icon,__assign({},r,{className:e.css("ms-ContextualMenu-icon",r.className)})):null,i.createElement("span",{className:"ms-ContextualMenu-itemText"},n.name),n.pinningOptions&&n.pinningOptions.isPinnable?i.createElement(s.TooltipHost,{hostClassName:"flex",content:u,directionalHint:12,calloutProps:{beakWidth:10}},i.createElement("div",{ref:function(n){t.pinElement=n},className:"pin flex",tabIndex:-1,onClick:this._onPinClick,onKeyDown:this._onPinKeyDown},i.createElement(o.Icon,{className:e.css("ms-ContextualMenu-iconRight",f),iconName:h}))):null)))},t.prototype._togglePinState=function(){if(this.props.item.pinningOptions&&this.props.item.pinningOptions.onPinnedChanged)this.props.item.pinningOptions.onPinnedChanged(this.props.item,!this.props.item.pinningOptions.isPinned)},t}(u.VssComponent);t[n].PinnedMenuItem=r;u.VssComponent.register("pinnedMenuItem",r)}("ComponentsPinnedMenuItemPinnedMenuItem"),function(n){b=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});var r=function(n){function t(i){var r=n.call(this,i)||this;return r.onFpsLoading=function(n){r.lastLoadingEvent=n.detail;r.loadingDelayTimeout||(r.loadingDelayTimeout=r.setTimeout(function(){r.setState({showLoadingIndicator:!0});r.loadingDelayTimeout=0},t.preProgressDelay))},r.onFpsCompleted=function(n){r.lastLoadingEvent&&r.lastLoadingEvent.data===n.detail.data&&(r.lastLoadingEvent=undefined,r.loadingDelayTimeout&&r.clearTimeout(r.loadingDelayTimeout),r.state.showLoadingIndicator&&r.setState({showLoadingIndicator:!1}))},r.state={},r}return __extends(t,n),t.prototype.render=function(){return this.state.showLoadingIndicator?i.createElement(h.Layer,{className:"fps-loading-content-layer",contentClassName:"fps-loading-content fontSizeM",contentLocation:1,contentJustification:1,contentOrientation:0,isModal:!0},i.createElement(c.Spinner,{label:y.Loading,size:c.SpinnerSize.large})):null},t.prototype.componentDidMount=function(){n.prototype.componentDidMount.call(this);this.addEventListener(document.body,"fpsLoading",this.onFpsLoading);this.addEventListener(document.body,"fpsCompleted",this.onFpsCompleted)},t.preProgressDelay=500,t}(u.VssComponent);t[n].FpsLoadingComponent=r;u.VssComponent.register("fpsLoading",r)}("ComponentsFpsLoadingFpsLoading"),function(n){k=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});var i=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t._onFPSItemClick=function(n,i,r){a.onClickFPS(t.pageContext,i,!0,n,{telemetrySource:"headerBreadcrumb",navigationId:r})},t}return __extends(t,n),t.prototype.loadItems=function(n){var t=[];this._addCollectionItem(t);this._addProjectItem(t);this._addHubItems(t);n(t)},t.prototype._addCollectionItem=function(n){var i=this.pageContext.getService("IVssPageService"),t=i.getData();t&&n.push({key:"Collection",text:t.hostName,href:t.hostPath,rank:10})},t.prototype._addProjectItem=function(n){var r=this,u=this.pageContext.getService("ITfsPageService"),t=u.getData(),i;t&&t.project&&(i=t.project.url,n.push({key:"Project",text:t.project.name,href:i,onClick:function(n){r._onFPSItemClick(n,i||"","ms.vss-web.home-hub-group")},rank:20}))},t.prototype._addHubItems=function(n){var u=this,r=this.pageContext.getService("IVssNavigationService"),f=r.getDisplayedNavigation(),i=r.getNavigation(f[2]),t=r.getNavigation(f[3]);i!==undefined&&i.name&&n.push({key:"HubGroup",text:i.name,href:i.href,onClick:function(n){u._onFPSItemClick(n,i.href||"",i.id)},rank:30});t!==undefined&&t.parentId&&t.name&&n.push({key:"Hub",text:t.name,href:t.href,onClick:function(n){u._onFPSItemClick(n,t.href||"",t.id)},rank:40})},t}(l.VssService);l.Services.add("header-breadcrumb-service",{serviceFactory:i})}("HeaderBreadcrumbService"),function(n){d=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});var r=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.show=function(){var n=this.pageContext.getService("IVssLayoutManager");n.renderCallout(function(){return i.createElement(u.WrappedComponent,{wrappedType:"legacy",dependencies:["ms.vss-web.legacy-content"],wrappedProps:{componentType:"legacyProfileDialog",modules:["Admin/Scripts/LegacyProfileDialogComponent"]}},null)})},t}(l.VssService);l.Services.add("LegacyProfileDialogService",{serviceFactory:r})}("LegacyProfileDialogService"),function(n){g=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});var i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.getMruRouteService=function(){var r=this.pageContext.getService("IVssContributionService"),t=r.getContributionsByType("ms.vss-tfs-web.mru-route-service"),n=undefined,i=undefined;for(var u in t)(!i||t[u].priority>i.priority)&&(n=u,i=t[n]);return n?r.getService(n).then(function(n){if(n)return n;throw new Error("Failed to create mru route service for the request mru entry.");}):Promise.resolve(this.getDefaultMruRouteService())},t.prototype.getDefaultMruRouteService=function(){return new r(this.pageContext)},t}(l.VssService),r=function(){function n(n){this.id="default-tfs-mru-route-service";this.pageContext=n}return n.prototype.routeUrl=function(n){var t=this.pageContext.getService("IVssLocationService");return t.routeUrl("ms.vss-tfs-web.redirect-route",n)},n}();l.Services.add("IMruRouteResolverService",{serviceFactory:i})}("MruRouteResolverService"),function(n){function i(i){for(var r in i)t[n].hasOwnProperty(r)||(t[n][r]=i[r])}nt=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});i(p)}("PinnedMenuItem"),function(n){tt=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});var i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.loadItems=function(n){var h=this;this._itemsUpdated=n;var t=[],c=!1,b=this.pageContext.getService("IVssPageService"),l=b.getData();l&&(c=(l.hostType&2)==2);var k=this.pageContext.getService("IVssNavigationService"),r=k.getCurrentRoute(),d=r&&r.routeId==="ms.vss-tfs-web.project-overview-route",e=this.pageContext.getService("IVssLocationService"),g=this.pageContext.getService("ITfsPageService"),o=g.getData(),u="",s="",i,a=!1;o&&(o.project?(a=!0,i=o.project.name,t.push({key:"browse-home",className:"browse-home-menu-item",iconProps:{className:"bowtie-icon bowtie-home-fill"},rank:1,name:v.format(y.BrowseHome,i),href:e.routeUrl("ms.vss-tfs-web.project-overview-route",{project:i}),groupKey:"navigation"}),t.push({key:"new-team",iconProps:{className:"bowtie-icon bowtie-users"},rank:1,href:e.routeUrl("ms.vss-admin-web.admin-project-home-route",{project:i,launchNewTeamDialog:"true"}),name:y.NewTeam,groupKey:"actions"})):u="home");var p=!1,w="navigation",f={},nt=this.pageContext.getService("IVssContributionService");nt.getDataAsync("ms.vss-tfs-web.navigation-mru-data-provider",{maxcount:5}).then(function(n){var o=h.pageContext.getService("IMruRouteResolverService");o.getMruRouteService().then(function(o){var ft,et,g,l,b,ut,st,k,tt;if(n){for(ft=n.mruItems,et=r.routeValues.parameters,g=0;g<ft.length;g++)if(l=ft[g],b={project:l.project,toRouteId:a?r.routeId:""},et&&(b.toParameters=et),l.team&&(b.team=l.team),!i||l.team||!v.equals(i,l.project,!0)){p||(p=!0,w="mru");d&&l.team&&(delete b.toRouteId,u="Home",s="Index");var nt=void 0,it=void 0,ht=void 0,ot="",rt=void 0;l.project?l.team?(rt=v.format("{0}-{1}-{2}",l.project,l.team,l.serviceHost.id),nt=v.format("{0} / {1}",l.project,l.team),it=v.format(y.TeamTitle,l.team,l.project),ot="bowtie-icon bowtie-users"):(nt=l.project,rt=v.format("{0}-{1}",l.project,l.serviceHost.id),it=v.format(y.ProjectTitle,l.project),ot="bowtie-icon bowtie-briefcase"):(rt="projects",nt=y.Projects,it=y.SelectProject);tt=nt.toLowerCase();f[tt]=f[tt]?2:1;u&&(b.toController=u);s&&(b.toAction=s);ht=o.routeUrl(b,l.serviceHost.vdir);t.push({key:rt,rank:g+10,hostName:l.serviceHost?l.serviceHost.name:"",name:nt,title:it,iconProps:{className:ot},href:ht,groupKey:"mru"})}t.push.apply(t,n.menuItems)}for(ut=0,st=t;ut<st.length;ut++)k=st[ut],k.name&&(tt=k.name.toLowerCase(),f[tt]>1&&k.hostName&&(k.name=v.format("{0} ({1})",k.name,k.hostName)));c||t.push({key:"browse",rank:1e3,name:y.Browse,groupKey:w,href:e.routeUrl("ms.vss-tfs-web.collection-project-hub-route",{})});h._itemsUpdated(t,[])})})},t}(l.VssService);l.Services.add("project-selector-menu-service",{serviceFactory:i})}("ProjectSelectorHeaderActions"),function(n){it=t[n]={};Object.defineProperty(t,"__esModule",{value:!0});var r=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype._serviceStart=function(t){n.prototype._serviceStart.call(this,t);var r=this.pageContext.getService("ITfsPageService"),i=r.getData();this._shortcutsAvailable=!!i&&!!i.project},t.prototype.loadItems=function(n){var i=this,t;this._shortcutsAvailable&&(t=[{key:"tfsShortcutKeys",name:y.KeyboardShortcuts,rank:550,groupKey:"other-actions",onClick:function(){i.showDialog()}}],n(t))},t.prototype.showDialog=function(){var n=this.pageContext.getService("IVssLayoutManager");n.renderCallout(function(n){return i.createElement(u.WrappedComponent,{wrappedType:"shortcutDialog",onDismiss:function(){n()}},null)})},t}(l.VssService);t[n].ShortcutMenuProviderService=r;l.Services.add("ms.vss-tfs-web.shortcut-menu-provider",{serviceFactory:r})}("ShortcutMenuProvider")},["Resources","Components/HeaderBreadcrumb/HeaderBreadcrumb","Components/PinnedMenuItem/PinnedMenuItem","Components/FpsLoading/FpsLoading","HeaderBreadcrumbService","LegacyProfileDialogService","MruRouteResolverService","PinnedMenuItem","ProjectSelectorHeaderActions","ShortcutMenuProvider"]);document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-tfs-web.header-async-content"}}));